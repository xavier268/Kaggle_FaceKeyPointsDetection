---
title: "9.submit"
output: 
  html_document:
    toc: yes
params:
  env: "dataLoaded.RData"
---

# Saving a submission file

*Started on `r date()`*

## Loading the data

We load from the compiled, preformatted data saved earlier.
We also define the random seed for repeatability.

```{r}
set.seed(56)
load(file = params$env)
ls() 
```


## Creating a dummy test predictions

To have a comparable assumption as the web tutorial, I'll use **d.key.mean.all**. The function below generates the dummy predictions.
Predictions should be ordered by **d.lookup**.

```{r}
predictions.dummy<- function(){
  matrix(data=d.key.mean.all, nrow=nrow(d.test), ncol=ncol(d.train), byrow=T)
}

head(predictions.dummy())
```

## Create the submission from the predictions, and save it to csv

We first create a function to save the predictions, then apply it to our testPrediction.

**NB** : Make sure you don't use factor internal representation, but convert them to string !

```{r}
predictions.save <- function(predictions) {
  submission <- read.csv(file = "../Dataset/IdLookupTable.csv")
  
  for(i in 1:nrow(submission)){
    imId <- submission$ImageId[i]
    feat <- as.character(submission$FeatureName[i]) 
    # required as.character() ! 
    # Internal factor representations will not match corectly !!
    submission$Location[i] <- predictions[imId,which(d.lookup==feat)]
  }
  
  submission$ImageId <-  NULL
  submission$FeatureName <- NULL
  sfile <-format(Sys.time(), "Submission%d%b%Yat%Hh%Mm%Ss.csv")
  write.csv(submission,file=sfile, row.names = FALSE, quote = FALSE)
  message("The file ",sfile," was saved for submission")
}
```

Now, let's save the testPrediction :

```{r}
predictions.save(predictions.dummy())
```

This file was confirmed with a 3,96244 public board test !

*This file was compiled on  `r date()`*
